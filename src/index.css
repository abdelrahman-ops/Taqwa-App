@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Noto+Naskh+Arabic:wght@400;500;600;700&family=Amiri+Quran&display=swap');
@import "tailwindcss";

/* Tailwind v4: dark mode via data-theme */
@custom-variant dark (&:is([data-theme="dark"] *, [data-theme="dark"]));

/*
 * CRITICAL: In Tailwind v4, @import "tailwindcss" puts everything in
 * @layer base/components/utilities. Unlayered CSS ALWAYS beats layered
 * CSS in the cascade — so all custom styles MUST go inside @layer blocks,
 * otherwise they override every Tailwind utility (mb-4, px-4, gap-2, etc.).
 */

/* ── Base: lowest priority, below utilities ── */
@layer base {
  :root {
    --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    --font-arabic: 'Noto Naskh Arabic', 'Amiri Quran', 'Traditional Arabic', serif;
    --nav-height: 64px;
    --color-primary: #047857;
    --color-primary-light: #059669;
    --color-gold: #D97706;
    --color-gold-light: #F59E0B;
  }

  html {
    font-family: var(--font-sans);
    -webkit-tap-highlight-color: transparent;
    scroll-behavior: smooth;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  body {
    min-height: 100dvh;
    background: #F8FAF8;
    overflow-x: hidden;
  }

  [data-theme="dark"] body {
    background: #0A0F0A;
  }

  /* Arabic / RTL */
  [dir="rtl"],
  [lang="ar"] {
    font-family: var(--font-arabic), var(--font-sans);
  }

  [lang="ar"] .latin-only {
    font-family: var(--font-sans);
  }

  /* Focus ring */
  :focus-visible {
    outline: 2px solid #059669;
    outline-offset: 2px;
  }

  /* Touch targets on mobile */
  @media (hover: none) and (pointer: coarse) {
    button, [role="button"] {
      min-height: 44px;
    }
  }
}

/* ── Components: custom reusable classes ── */
@layer components {
  .arabic-text {
    font-family: 'Amiri Quran', var(--font-arabic);
    font-size: 1.25rem;
    line-height: 2.2;
    text-align: right;
    direction: rtl;
  }

  .bismillah {
    font-family: 'Amiri Quran', var(--font-arabic);
    font-size: 1.5rem;
    line-height: 2;
    text-align: center;
    direction: rtl;
    letter-spacing: 0.02em;
  }

  /* Progress Ring */
  .progress-ring-container {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    filter: drop-shadow(0 2px 8px rgba(5, 150, 105, 0.15));
  }

  .progress-ring-svg {
    display: block;
  }

  .progress-ring-circle {
    transition: stroke-dashoffset 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .progress-ring-content {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .progress-ring-text {
    font-weight: 800;
    font-size: 1.5rem;
    color: var(--color-primary);
  }

  [data-theme="dark"] .progress-ring-text {
    color: #34D399;
  }

  /* Card */
  .card {
    background: white;
    border-radius: 1rem;
    border: 1px solid #E5E7EB;
    padding: 1rem;
    margin-bottom: 0.75rem;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
  }

  [data-theme="dark"] .card {
    background: #111B11;
    border-color: #1F2D1F;
  }
}

/* ── Utilities: same priority as Tailwind utilities ── */
@layer utilities {
  .no-scrollbar::-webkit-scrollbar { display: none; }
  .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

  .spinner { animation: spin 1s linear infinite; }
  .pulse-green { animation: pulse-green 2s ease-in-out infinite; }
  .bounce-in { animation: bounce-in 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); }
  .fade-in { animation: fade-in 0.4s ease-out; }
  .glow { animation: glow 2s ease-in-out infinite; }
  .float { animation: float 3s ease-in-out infinite; }
  .shimmer { animation: shimmer 2s linear infinite; background-size: 200% 100%; }
  .celebrate { animation: celebrate 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94); }

  /* Flame streak number pulse */
  .number-pulse {
    animation: numberPulse 2.5s ease-in-out infinite;
  }

  /* Flame streak icon */
  .flame-flicker {
    animation: flame-flicker 0.9s ease-in-out infinite;
    filter: drop-shadow(0 0 8px rgba(249, 115, 22, 0.65)) drop-shadow(0 2px 12px rgba(234, 88, 12, 0.45));
    transform-origin: center bottom;
  }

  /* Celebration overlay */
  .celebrate-overlay {
    animation: celebrate-entrance 0.5s ease-out, celebrate-exit 0.5s ease-in 2.5s forwards;
  }

  /* Staggered card animations */
  .stagger-1 { animation-delay: 0.05s; }
  .stagger-2 { animation-delay: 0.1s; }
  .stagger-3 { animation-delay: 0.15s; }
  .stagger-4 { animation-delay: 0.2s; }
  .stagger-5 { animation-delay: 0.25s; }

  .slide-up {
    animation: slide-up 0.4s ease-out both;
  }

  @supports (padding: env(safe-area-inset-bottom)) {
    .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
  }
}

/* ── Keyframes (don't participate in cascade, safe outside layers) ── */
@keyframes spin { to { transform: rotate(360deg); } }
@keyframes pulse-green {
  0%, 100% { box-shadow: 0 0 0 0 rgba(5, 150, 105, 0.4); }
  50% { box-shadow: 0 0 0 10px rgba(5, 150, 105, 0); }
}
@keyframes bounce-in {
  0% { transform: scale(0.6); opacity: 0; }
  60% { transform: scale(1.08); opacity: 1; }
  100% { transform: scale(1); }
}
@keyframes fade-in {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
@keyframes glow {
  0%, 100% { opacity: 0.5; transform: scale(1); }
  50% { opacity: 1; transform: scale(1.1); }
}
@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-4px); }
}
@keyframes shimmer {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}
@keyframes celebrate {
  0% { transform: scale(1); }
  25% { transform: scale(1.15); }
  50% { transform: scale(0.95); }
  75% { transform: scale(1.05); }
  100% { transform: scale(1); }
}
@keyframes flame-flicker {
  0%   { transform: scaleY(1)    scaleX(1);    opacity: 1;    }
  15%  { transform: scaleY(1.07) scaleX(0.95); opacity: 0.97; }
  30%  { transform: scaleY(0.96) scaleX(1.04); opacity: 1;    }
  45%  { transform: scaleY(1.05) scaleX(0.96); opacity: 0.96; }
  60%  { transform: scaleY(0.97) scaleX(1.03); opacity: 1;    }
  75%  { transform: scaleY(1.04) scaleX(0.97); opacity: 0.98; }
  90%  { transform: scaleY(0.99) scaleX(1.01); opacity: 1;    }
  100% { transform: scaleY(1)    scaleX(1);    opacity: 1;    }
}
@keyframes celebrate-entrance {
  from { opacity: 0; transform: scale(0.5) translateY(20px); }
  to { opacity: 1; transform: scale(1) translateY(0); }
}
@keyframes celebrate-exit {
  from { opacity: 1; transform: scale(1) translateY(0); }
  to { opacity: 0; transform: scale(0.8) translateY(-20px); }
}
@keyframes numberPulse {
  0%, 100% { transform: scale(1); }
  50%       { transform: scale(1.08); }
}
@keyframes slide-up {
  from { opacity: 0; transform: translateY(16px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ── Reduced motion (intentionally unlayered + !important to override all) ── */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    transition-duration: 0.01ms !important;
  }
}
